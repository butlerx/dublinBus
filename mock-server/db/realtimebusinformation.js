const moment = require('moment');
const { isUndefined } = require('lodash');

const realtimebusinformation = [
  {
    stopid: '1344',
    results: [
      {
        arrivaldatetime: '28/01/2018 13:24:22',
        duetime: '3',
        departuredatetime: '28/01/2018 13:24:22',
        departureduetime: '3',
        scheduledarrivaldatetime: '28/01/2018 13:28:00',
        scheduleddeparturedatetime: '28/01/2018 13:28:00',
        destination: 'Dublin Airport',
        destinationlocalized: 'Aerfort',
        origin: 'Brehon Field Rd',
        originlocalized: 'Brehon Field Rd',
        direction: 'Inbound',
        operator: 'bac',
        additionalinformation: '',
        lowfloorstatus: 'no',
        route: '16',
        sourcetimestamp: '28/01/2018 13:17:27',
        monitored: 'true',
      },
      {
        arrivaldatetime: '28/01/2018 13:36:02',
        duetime: '14',
        departuredatetime: '28/01/2018 13:36:02',
        departureduetime: '14',
        scheduledarrivaldatetime: '28/01/2018 13:34:00',
        scheduleddeparturedatetime: '28/01/2018 13:34:00',
        destination: 'Charlestown',
        destinationlocalized: 'Baile Shéarlais',
        origin: 'Limekiln Ave',
        originlocalized: 'Limekiln Ave',
        direction: 'Inbound',
        operator: 'bac',
        additionalinformation: '',
        lowfloorstatus: 'no',
        route: '9',
        sourcetimestamp: '28/01/2018 13:17:27',
        monitored: 'true',
      },
      {
        arrivaldatetime: '28/01/2018 13:38:12',
        duetime: '16',
        departuredatetime: '28/01/2018 13:38:12',
        departureduetime: '16',
        scheduledarrivaldatetime: '28/01/2018 13:38:00',
        scheduleddeparturedatetime: '28/01/2018 13:38:00',
        destination: 'Pearse St',
        destinationlocalized: 'Sráid an Phiarsaigh',
        origin: 'Kiltipper Wy',
        originlocalized: 'Kiltipper Wy',
        direction: 'Inbound',
        operator: 'bac',
        additionalinformation: '',
        lowfloorstatus: 'no',
        route: '54A',
        sourcetimestamp: '28/01/2018 13:19:06',
        monitored: 'true',
      },
      {
        arrivaldatetime: '28/01/2018 13:47:59',
        duetime: '26',
        departuredatetime: '28/01/2018 13:47:59',
        departureduetime: '26',
        scheduledarrivaldatetime: '28/01/2018 13:48:00',
        scheduleddeparturedatetime: '28/01/2018 13:48:00',
        destination: 'Dublin Airport',
        destinationlocalized: 'Aerfort',
        origin: 'Brehon Field Rd',
        originlocalized: 'Brehon Field Rd',
        direction: 'Inbound',
        operator: 'bac',
        additionalinformation: '',
        lowfloorstatus: 'no',
        route: '16',
        sourcetimestamp: '28/01/2018 12:49:22',
        monitored: 'true',
      },
      {
        arrivaldatetime: '28/01/2018 13:48:40',
        duetime: '27',
        departuredatetime: '28/01/2018 13:48:40',
        departureduetime: '27',
        scheduledarrivaldatetime: '28/01/2018 13:49:00',
        scheduleddeparturedatetime: '28/01/2018 13:49:00',
        destination: 'Charlestown',
        destinationlocalized: 'Baile Shéarlais',
        origin: 'Limekiln Ave',
        originlocalized: 'Limekiln Ave',
        direction: 'Inbound',
        operator: 'bac',
        additionalinformation: '',
        lowfloorstatus: 'no',
        route: '9',
        sourcetimestamp: '28/01/2018 12:49:22',
        monitored: 'true',
      },
      {
        arrivaldatetime: '28/01/2018 14:03:40',
        duetime: '42',
        departuredatetime: '28/01/2018 14:03:40',
        departureduetime: '42',
        scheduledarrivaldatetime: '28/01/2018 14:04:00',
        scheduleddeparturedatetime: '28/01/2018 14:04:00',
        destination: 'Charlestown',
        destinationlocalized: 'Baile Shéarlais',
        origin: 'Limekiln Ave',
        originlocalized: 'Limekiln Ave',
        direction: 'Inbound',
        operator: 'bac',
        additionalinformation: '',
        lowfloorstatus: 'no',
        route: '9',
        sourcetimestamp: '28/01/2018 13:04:14',
        monitored: 'true',
      },
      {
        arrivaldatetime: '28/01/2018 14:04:44',
        duetime: '43',
        departuredatetime: '28/01/2018 14:04:44',
        departureduetime: '43',
        scheduledarrivaldatetime: '28/01/2018 14:05:00',
        scheduleddeparturedatetime: '28/01/2018 14:05:00',
        destination: 'Pearse St',
        destinationlocalized: 'Sráid an Phiarsaigh',
        origin: 'Tallaght',
        originlocalized: 'Tamhlacht',
        direction: 'Inbound',
        operator: 'bac',
        additionalinformation: '',
        lowfloorstatus: 'no',
        route: '49',
        sourcetimestamp: '28/01/2018 13:05:53',
        monitored: 'true',
      },
      {
        arrivaldatetime: '28/01/2018 14:07:59',
        duetime: '46',
        departuredatetime: '28/01/2018 14:07:59',
        departureduetime: '46',
        scheduledarrivaldatetime: '28/01/2018 14:08:00',
        scheduleddeparturedatetime: '28/01/2018 14:08:00',
        destination: 'Dublin Airport',
        destinationlocalized: 'Aerfort',
        origin: 'Brehon Field Rd',
        originlocalized: 'Brehon Field Rd',
        direction: 'Inbound',
        operator: 'bac',
        additionalinformation: '',
        lowfloorstatus: 'no',
        route: '16',
        sourcetimestamp: '28/01/2018 13:09:11',
        monitored: 'true',
      },
      {
        arrivaldatetime: '28/01/2018 14:18:40',
        duetime: '57',
        departuredatetime: '28/01/2018 14:18:40',
        departureduetime: '57',
        scheduledarrivaldatetime: '28/01/2018 14:19:00',
        scheduleddeparturedatetime: '28/01/2018 14:19:00',
        destination: 'Charlestown',
        destinationlocalized: 'Baile Shéarlais',
        origin: 'Limekiln Ave',
        originlocalized: 'Limekiln Ave',
        direction: 'Inbound',
        operator: 'bac',
        additionalinformation: '',
        lowfloorstatus: 'no',
        route: '9',
        sourcetimestamp: '28/01/2018 13:19:06',
        monitored: 'true',
      },
    ],
  },
];

module.export = (stopId, routeId, maxResults) => {
  const timestamp = moment().format('DD/MM/YYYY HH:mm:ss');

  if (isUndefined(stopId)) {
    return {
      errorcode: '2',
      errormessage: "'stopid' parameter is required.",
      numberofresults: 0,
      stopid: null,
      timestamp,
      results: [],
    };
  }
  let results = realtimebusinformation.filter(({ stopid }) => stopid === stopId)[0].results;
  if (routeId) {
    results = results.filter(({ route }) => route === routeId);
  }
  const error = results.length === 0;
  return {
    errorcode: error ? 1 : 0,
    errormessage: error ? 'No Results' : '',
    numberofresults: results.length,
    stopid: stopId,
    timestamp,
    results: maxResults ? results.splice(maxResults) : results,
  };
};
